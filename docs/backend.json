{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Cayetano Library Hub.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role of the user (Admin, Editor, User)."
        }
      },
      "required": [
        "id",
        "email",
        "role"
      ]
    },
    "Material": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Material",
      "type": "object",
      "description": "Represents a document or material in the Cayetano Library Hub.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Material entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the material."
        },
        "author": {
          "type": "string",
          "description": "Author of the material."
        },
        "year": {
          "type": "number",
          "description": "Publication year of the material."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Material)"
        },
        "description": {
          "type": "string",
          "description": "Description of the material."
        },
        "tags": {
          "type": "array",
          "description": "Tags associated with the material.",
          "items": {
            "type": "string"
          }
        },
        "fileUrl": {
          "type": "string",
          "description": "URL of the PDF file (stored in Google Drive).",
          "format": "uri"
        },
        "lastUpdateDate": {
          "type": "string",
          "description": "Date of last update.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "author",
        "year",
        "categoryId",
        "description",
        "tags",
        "fileUrl",
        "lastUpdateDate"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category or subfolder for organizing materials.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Category entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        },
        "parentCategoryId": {
          "type": "string",
          "description": "Reference to parent Category. (Relationship: Category 1:N Category). Null if it is a root category."
        }
      },
      "required": [
        "id",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Uses path-based ownership for private data. The 'userId' parameter corresponds to the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores categories for organizing materials.",
          "params": [
            {
              "name": "categoryId",
              "description": "Unique identifier for the category."
            }
          ]
        }
      },
      {
        "path": "/materials/{materialId}",
        "definition": {
          "entityName": "Material",
          "schema": {
            "$ref": "#/backend/entities/Material"
          },
          "description": "Stores material documents. Includes 'categoryId' which is denormalized from Category for authorization independence and efficient querying.",
          "params": [
            {
              "name": "materialId",
              "description": "Unique identifier for the material."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Documents in this collection denote admin users. Authorization relies on existence over content.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the administrator."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support the Cayetano Library Hub's core features, emphasizing security, scalability, and ease of debugging, while adhering to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. The structure incorporates denormalization to eliminate `get()` calls in security rules, enabling atomic operations and simplifying authorization logic.\n\n1.  **Authorization Independence:** The structure achieves authorization independence primarily through denormalization. The `Material` documents contain the `categoryId` that links to a category and through this, we can create rules that give users access to all the Materials of a Category without needing to execute a `get()` call on the category itself.\n2.  **Structural Segregation:** The structure uses structural segregation. For instance, the `/users/{userId}` collection is separated from the `/categories` and `/materials` collections, ensuring that documents with different security requirements are not mixed.\n3.  **Access Modeling:** The structure leverages path-based ownership for user-specific data (e.g., `/users/{userId}`). Collaborative access to categories is implicitly managed based on user roles (Admin, Editor, User). Editors can create, modify, and delete categories. Material documents store `categoryId` enabling easy filtering, and QAPs.\n4.  **QAPs:** The structure supports QAPs by using structural segregation and by storing the `categoryId` in the Material documents. This allows secure `list` operations since rules can check permissions based on user role and/or the value of the categoryId field, without needing to filter based on the content of the documents."
  }
}